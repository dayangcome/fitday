<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>运动计划</title>
        <link rel="stylesheet" href="../../../public/plugins/element-ui/index.css" />
        <style type="text/css">
            body{
                padding-right: 0 !important;
            }
            .el-table::before{
                height: 0px;
            }
            .myflex{
                display:flex;
            }
            .left{
                width:65%;
                display:flex;
                flex-wrap: wrap;
                align-content: flex-start;
                border-right: 1px solid #DCDFE6;
            }
            .right{
                width:35%;
                padding:0 35px;
                
            }
            .plan{
                padding:0 30px;
                width:100%;
                height: 450px;
                border-bottom: 1px solid #DCDFE6;
            }
            .mainpart{
                width: 100%;
                height:400px;
                display:flex;
            }
            .mainleft{
                width: 58%;
            }
            .mainright{
                width: 42%;
                padding: 0 31px;
            }
            .el-progress--circle .el-progress__text, .el-progress--dashboard .el-progress__text{
                top: 36%;
            }
            h3{
                display: inline-block;
                margin: 20px 0;
            }
            h4{
                margin: 15px;
            }
            .recommend{
                border-top: 1px solid #ffffff;
                padding: 0 30px;
                width: 100%;
            }
            .time{
                font-size: 17px;
                font-weight: bold;
                margin: 0 5px;
            }
            .el-input__inner{
               border: 1.5px solid #ccc;
               border-radius: 28px;
            }
            .bottom {
                margin-top: 13px;
                line-height: 12px;
              }
            
              .button {
                padding: 0;
                float: right;
              }
            
              .image {
                width: 189px;
                height: 142px;
                display: block;
              }
            
              .clearfix:before,
              .clearfix:after {
                  display: table;
                  content: "";
              }
              
              .clearfix:after {
                  clear: both
              }
              .rightup{
                  height: 450px;
              }
        </style>
    </head>
    <body>
        <div id="app">
           <div class="myflex">
                <div class="left">
                    <div class="plan">
                        <div class="mainpart">
                            <div class="mainleft">
                                <h3>运动计划</h3>
                                <el-card class="box-card" shadow="hover" :key="mykey">
                                    <el-table
                                        :data="planlist"
                                        stripe
                                        style="width: 100%;margin-bottom: 20px;height: 220px;overflow-y:auto"
                                        :show-header="false"
                                        highlight-current-row
                                        >
                                        <el-table-column
                                          prop="content"
                                          >
                                        </el-table-column>
                                        <el-table-column>
                                          <template slot-scope="scope">
                                            <el-button
                                              type="success"
                                              size="medium"
                                              icon="el-icon-check"
                                              :disabled="daymove!=0"
                                              @click="userdetail(scope.row)"
                                            >
                                                完成
                                            </el-button>
                                            <el-button
                                              type="danger"
                                              size="medium"
                                              icon="el-icon-delete"
                                              :disabled="daymove!=0"
                                              @click="mydel(scope.row)"

                                            >
                                                删除
                                            </el-button>
                                          </template>
                                        </el-table-column>
                                      </el-table>
                                      <el-button type="success" plain @click="addplan('select')" :disabled="daymove!=0">+ 添加计划</el-button>
                                      <el-button type="info" plain @click="addplan('write')" :disabled="daymove!=0">+ 自定义计划</el-button>
                                      <el-button type="danger" plain @click="delall" :disabled="daymove!=0">清空计划</el-button>
                                     <el-button type="primary" plain @click="ymfresh">刷新</el-button>
                                </el-card>
                                
                                <el-dialog title="制定运动计划" :visible.sync="sportVisible" width="40%">
                                  <el-form>
                                    <el-form-item label="运动时间" label-width="80px">
                                      <el-time-select
                                          placeholder="起始时间"
                                          v-model="startTime"
                                          :picker-options="{
                                            start: '05:00',
                                            step: '00:15',
                                            end: '23:30'
                                          }">
                                        </el-time-select>
                                        <el-time-select
                                          placeholder="结束时间"
                                          v-model="endTime"
                                          :picker-options="{
                                            start: '05:15',
                                            step: '00:15',
                                            end: '23:45',
                                            minTime: startTime
                                          }">
                                        </el-time-select>
                                    </el-form-item>
                                    <el-form-item label="运动项目" label-width="80px">
                                    <el-select v-model="value2" placeholder="请选择运动项目">
                                        <el-option
                                          v-for="item in alllist"
                                          :key="item.sportName"
                                          :label="item.sportName"
                                          :value="item.sportName">
                                        </el-option>
                                      </el-select>
                                  </el-form-item>
                                  </el-form>
                                  <div slot="footer" class="dialog-footer">
                                    <el-button @click="sportVisible = false">取 消</el-button>
                                    <el-button type="primary" @click="sportchoose('select')">确 定</el-button>
                                  </div>
                                </el-dialog>
                                
                                <el-dialog title="自定义运动计划" :visible.sync="mysportVisible" width="40%">
                                  <el-form>
                                    <el-form-item label="运动时间" label-width="80px">

                                        <el-time-select
                                                placeholder="起始时间"
                                                v-model="value3"
                                                :picker-options="{
                                            start: '05:00',
                                            step: '00:15',
                                            end: '23:30'
                                          }">
                                        </el-time-select>
                                        <el-time-select
                                                placeholder="结束时间"
                                                v-model="value4"
                                                :picker-options="{
                                            start: '05:15',
                                            step: '00:15',
                                            end: '23:45',
                                            minTime: startTime
                                          }">
                                        </el-time-select>
                                    </el-form-item>
                                    <el-form-item label="运动内容" label-width="80px">
                                    <el-input
                                      type="textarea"
                                      :rows="2"
                                      placeholder="请输入运动内容"
                                      v-model="myssport">
                                    </el-input>
                                  </el-form-item>
                                  </el-form>
                                  <div slot="footer" class="dialog-footer">
                                    <el-button @click="mysportVisible = false">取 消</el-button>
                                    <el-button type="primary" @click="sportchoose('my')">确 定</el-button>
                                  </div>
                                </el-dialog>
                                
                            </div> 
                            <div class="mainright">
                                <h3 style="margin-bottom: 0px;">完成情况</h3>
                                <div style="display: flex;justify-content: space-around">
                                    <el-progress type="circle" :format="format" :percentage="50" :width="170" style="margin-top: 70px;"></el-progress>
                                    <div style="display: flex;flex-direction: column;padding-left: 40px;">
                                        <div style="height: 100px;width: 100px;border:5px solid rgb(0, 255, 121);border-radius: 50%;text-align: center;padding: 15px;margin-bottom: 40px;">
                                        已消耗 <h4>{{finish}}</h4> 卡路里
                                        </div>
                                        <div style="height: 100px;width: 100px;border:5px solid rgb(225, 48, 48);border-radius: 50%;text-align: center;padding: 15px;">
                                        待消耗 <h4>{{finish}}</h4> 卡路里
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                        </div> 
                        <div class="mydate" style="text-align: center;font-size: 18px;">
                            <i class="el-icon-arrow-left" style="cursor:pointer" @click="subday"></i>
                            <time class="time">{{ year }}/{{month}}/{{day}}</time>
                            <i class="el-icon-arrow-right" style="cursor:pointer" @click="addday"></i>
                        </div>
                         
                    </div>
                    
                    <div class="recommend">
                        
                        <h3>推荐计划</h3>
                        <el-input
                          v-model="input"
                          placeholder="搜索"
                          style="float: right;width: 350px;margin: 10px 50px 0 0;"
                          clearable
                           @keyup.enter.native="handleQuery"
                        >
                          <i
                            slot="suffix"
                            class="el-input__icon el-icon-search"
                            style="cursor: pointer;font-size: 17px;"
                            @click="handleQuery"
                          ></i>
                        </el-input>
                        <div style="display: flex;">
                            <div v-for="(o, index) in 4" :key="o" :offset="index > 0 ? 4 : 0" style="width: 220px;margin-right: 50px;">
                                <el-card :body-style="{ padding: '0px' }" shadow="hover">
                                  <img src="../../assets/img/portfolio/1.png" class="image">
                                  <div style="padding: 14px;">
                                    <span>计划{{o}}</span>
                                    <div class="bottom clearfix">
                                      <el-button type="text" class="button">查看详情</el-button>
                                    </div>
                                  </div>
                                </el-card>
                              </div>
                        </div>
                        <br>
                        <el-button type="info" plain style="display: block;float: right;margin-right: 50px;">更多</el-button>
                        <el-button type="primary" plain style="display: block;float: right;margin:0 50px 30px 0;">刷新</el-button>

                        <h3>运动科普</h3>
                        <div style="display: flex;">
                            <div v-for="(item,index) in showlist" :key="index" style="width: 220px;margin-right: 50px;">
                                <el-card :body-style="{ padding: '0px' }" shadow="hover">
                                  <img :src="item.picture" class="image">
                                  <div style="padding: 14px;">
                                    <span>{{item.sportName}}</span>
                                    <div class="bottom clearfix">
                                      <el-button type="text" class="button">查看详情</el-button>
                                    </div>
                                  </div>
                                </el-card>
                              </div>
                        </div>
                        <br>
                        <el-button type="info" plain style="display: block;float: right;margin-right: 50px;">更多</el-button>
                        <el-button type="primary" plain style="display: block;float: right;margin-right: 50px;" @click="refresh">刷新</el-button>

                    </div>
                </div>
                <div class="right">
                    <div class="rightup">
                        <h3>运动记录</h3>
                        <el-table
                            :data="tableData"
                            stripe
                            style="width: 100%">
                            <el-table-column
                              prop="date"
                              label="日期"
                              >
                            </el-table-column>
                            <el-table-column
                              prop="name"
                              label="运动类型"
                              >
                            </el-table-column>
                            <el-table-column
                              prop="address"
                              label="完成情况">
                            </el-table-column>
                          </el-table>
                      </div>
                      <div class="rightdown">
                          <h3>运动日历</h3>
                          <el-calendar v-model="value">
                          </el-calendar>
                      </div>
                </div>
           </div>
            
        

        </div>
        <!-- 开发环境版本，包含了有帮助的命令行警告 -->
        <script src="../../../public/plugins/vue/vue.js"></script>
        <!-- 引入组件库 -->
        <script src="../../../public/plugins/element-ui/index.js"></script>

        <script src="../../../public/plugins/axios/axios.min.js"></script>
        <script src="../../../public/js/request.js"></script>
        <script src="../../myapi/sport.js"></script>
        <script>
            new Vue({
                el: '#app',
                data() {
                    return {
                        counts: 0,
                        input:'',
                        page: 1,
                        pageSize:5,
                        name:'',
                        mykey: 0,
                        sportData:[],
                        alllist:[],
                        showlist:[],
                        userInfo:{},
                        tableData:[],
                        mysportplan:[],
                        index:0,
                        sportVisible:false,
                        mysportVisible:false,
                        startTime: '',
                        endTime: '',
                      logintype:0,
                      finish:0,
                      consume:0,
                      year :new Date().getFullYear(),
                      month :new Date().getMonth() + 1,
                      day:new Date().getDate(),
                      value: new Date(),
                      pickerOptions: {
                        disabledDate(time) {
                            return time.getTime() > Date.now();
                        },
                        shortcuts: [{
                            text: '今天',
                            onClick(picker) {
                            picker.$emit('pick', new Date());
                            }
                        }, {
                            text: '昨天',
                            onClick(picker) {
                            const date = new Date();
                            date.setTime(date.getTime() - 3600 * 1000 * 24);
                            picker.$emit('pick', date);
                            }
                        }, {
                            text: '一周前',
                            onClick(picker) {
                            const date = new Date();
                            date.setTime(date.getTime() - 3600 * 1000 * 24 * 7);
                            picker.$emit('pick', date);
                            }
                        }]
                        },
                        value2: '',
                        value3: '',
                        value4: '',
                        daymove:0,
                        myssport:'',
                        planlist:[]
                    }
                },
                created(){
                    this.userInfo = JSON.parse(localStorage.getItem('userInfo'))
                    this.init()
                    this.init2()
                    this.init3()
                },
                mounted() {
                },
                methods: {
                    subday(){
                      this.daymove--;
                      console.log(this.daymove)
                        this.value.setTime(this.value.getTime() - 3600 * 1000 * 24);
                        this.year=this.value.getFullYear()
                        this.month=this.value.getMonth()+1
                        this.day=this.value.getDate()
                    },
                    addday(){
                        this.daymove++;
                        console.log(this.daymove)
                        this.value.setTime(this.value.getTime() + 3600 * 1000 * 24);
                        this.year=this.value.getFullYear()
                        this.month=this.value.getMonth()+1
                        this.day=this.value.getDate()
                    },
                    async mydel(st){
                        myplandel(st.sportPlanId).then(res => {
                            if (String(res.code) === '1') {

                                this.init3()
                                this.$message.warning('成功删除计划！')
                            }
                        }).catch(err => {
                            this.$message.error('请求出错了：' + err)
                        })
                    },
                    delall(){
                        for (let i = 0; i < this.planlist.length; i++) {
                            this.mydel(this.planlist[i])
                        }
                        this.init3()
                    },
                    ymfresh(){
                        location.reload()
                    },
                    async sportchoose(data){
                        if(data == 'select'){
                            this.sportVisible = false
                            var context=`${this.startTime} - ${this.endTime}   ${this.value2}`
                            await addplanList(this.userInfo.uid,context).then(res => {
                                if (String(res.code) === '1') {
                                    this.init3()
                                    this.mykey++
                                    this.$message.success('成功添加计划，若未显示请点击刷新按钮！')
                                }
                            }).catch(err => {
                                this.$message.error('请求出错了：' + err)
                            })
                        }else{
                            this.mysportVisible = false
                            var context=`${this.value3} - ${this.value4}   ${this.myssport}`
                            await addplanList(this.userInfo.uid,context).then(res => {
                                if (String(res.code) === '1') {

                                    this.init3()
                                    this.mykey++
                                    this.$message.success('成功添加计划，若未显示请点击刷新按钮！')
                                }
                            }).catch(err => {
                                this.$message.error('请求出错了：' + err)
                            })
                        }

                    },
                    async init () {
                        const params = {
                            page: this.page,
                            pageSize: this.pageSize,
                            name: this.input ? this.input : undefined
                        }
                        await getSportList(params).then(res => {
                            if (String(res.code) === '1') {
                                this.sportData = res.data.records|| []
                                this.counts = res.data.total
                            }
                        }).catch(err => {
                            this.$message.error('请求出错了：' + err)
                        })
                    },
                    async init2(){
                        this.alllist=[]
                        this.showlist=[]
                        await getAllList().then(res => {
                            if (String(res.code) === '1') {
                                this.alllist.push(...res.data)
                                var count=this.alllist.length
                                var ramnum=Math.floor(Math.random()*count)
                                this.showlist.push(this.alllist[ramnum])
                                this.showlist.push(this.alllist[(ramnum+1)%count])
                                this.showlist.push(this.alllist[(ramnum+2)%count])
                                this.showlist.push(this.alllist[(ramnum+3)%count])
                            }
                        }).catch(err => {
                            this.$message.error('请求出错了：' + err)
                        })
                    },
                    async init3 () {
                        await getplanList(this.userInfo.uid,this.daymove).then(res => {
                            if (String(res.code) === '1') {
                                this.planlist=res.data
                            }else {
                                console.log("not")
                            }
                        }).catch(err => {
                            this.$message.error('请求出错了：' + err)
                        })
                    },
                    handleQuery() {
                        this.page = 1;
                        this.init();
                    },
                    handleCurrentChange (val) {
                        this.page = val
                        this.init()
                    },
                    refresh(){
                        this.init2()
                    },
                    async submitex(){
                    },
                    goBack() {
                        window.location.href='../../index.html'
                    },
                    handleQuery(){
                        
                    },
                    addplan(method){
                        if(method=='select'){
                            this.sportVisible=true
                        }else{
                            this.mysportVisible=true
                        }
                    },
                    format(percentage) {
                        return `已完成${percentage}%`;
                    }
                },
                destroyed(){
                }
            })
        </script>
    </body>
</html>
