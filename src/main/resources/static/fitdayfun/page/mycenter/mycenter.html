<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>个人中心</title>
        <link rel="stylesheet" href="../../../public/plugins/element-ui/index.css" />
        <style>
            body, html {
                overflow-x: hidden;
            } 
          .avatar-uploader .el-upload {
            border: 1px dashed #d9d9d9;
            border-radius: 6px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
          }
          .avatar-uploader .el-upload:hover {
            border-color: #409EFF;
          }
          .avatar-uploader-icon {
            font-size: 28px;
            color: #8c939d;
            width: 178px;
            height: 178px;
            line-height: 178px;
            text-align: center;
          }
          .avatar {
            width: 178px;
            height: 178px;
            display: block;
          }
          .avatar-uploader{
              text-align: center;
          }
          label{
              font-weight: bold;
              font-size: 26px;
          }
          h3{
              display: inline-block;
              width: 130px;
          }
          .myrow{
              margin-top: 10px;
          }
          .el-tabs__item{
              font-size: 16px;
              font-weight: bold;
              
          }
          .time {
              font-size: 13px;
              color: #999;
          }

          .bottom {
              margin-top: 13px;
              line-height: 12px;
          }

          .button {
              padding: 0;
              float: right;
          }


          .clearfix:before,
          .clearfix:after {
              display: table;
              content: "";
          }

          .clearfix:after {
              clear: both
          }
          .left {

              width: 1500px;
              height: 400px;
              float: inherit;
              margin-left: 350px;
          }

          .right{
              margin-top: 80px;
              height: 400px;
          }

           .el-tag + .el-tag {
               margin-left: 10px;
           }
          .button-new-tag {
              margin-left: 10px;
              height: 32px;
              line-height: 30px;
              padding-top: 0;
              padding-bottom: 0;
          }
          .input-new-tag {
              width: 90px;
              margin-left: 10px;
              vertical-align: bottom;
          }
          .like {
              cursor: pointer;
              font-size: 25px;
              display: inline-block;
          }
            .el-avatar{
                background:#FFFFFF;
            }
        </style>
    </head>
    <body>
        <div id="app">
            
            <div class="banner" style="height: 120px; display: flex; background-image: url(../../assets/img/222.jpg);">
                <img src="../../assets/img/fitdaylogo.png" alt="" style="height:100px ;width:300px;margin:0 80px;">
                <span class="myfont" style="color: azure;
                font-size: 40px;
                line-height: 120px;
                margin-left: 100px;">吃好，练好，拥有好心态，轻装上阵！</span>
            </div>
            
            <el-page-header @back="goBack" style="line-height: 40px;margin-top: 10px">
            </el-page-header>
            
            <h1 style="text-align: center;">个人中心</h1>
            
            <div class="main" style="padding: 0 40px;">
               <div class="left">
                <el-tabs tab-position="left" >
                    <el-tab-pane label="基本信息" style="margin:0 20px">
                        <div class="info" style="margin:0 30px">
                            <h3>当前头像</h3>
                            <div style="display: flex;margin: 20px;">
                                <el-avatar :size="180" :src="circleUrl"></el-avatar>
                                <el-button type="success" round style="margin-left: 50px; margin-top: 100px;height: 42px;" @click="changeVisible = true">修改头像</el-button>
                            </div>
                            
                            <el-dialog
                              title="上传新头像"
                              :visible.sync="changeVisible"
                              width="30%"
                              >
                              <el-upload
                                class="avatar-uploader"
                                action="/common/upload"
                                :show-file-list="false"
                                :on-success="handleAvatarSuccess"
                                :before-upload="beforeAvatarUpload"
                              >
                                <img v-if="imageUrl" :src="imageUrl" class="avatar">
                                <i v-else class="el-icon-plus avatar-uploader-icon"></i>
                              </el-upload>
                              
                              <span slot="footer" class="dialog-footer">
                                <el-button type="primary" @click="changeavatar">确 定</el-button>
                                <el-button @click="changeVisible = false">取 消</el-button>
                              </span>
                            </el-dialog>

                            <div class="myrow">
                                <h3>我的昵称</h3>
                                <el-input
                                  v-model="username"
                                  prefix-icon="el-icon-user-solid"
                                  style="width: 300px;"
                                  >
                                </el-input>
                            </div>
                            <div class="myrow">
                                <h3>我的等级</h3>
                                {{userInfo.level}}
                               
                                <i class="el-icon-star-on" style="color:red"></i>
                                <h3 style="margin-left: 20px">我的余额</h3>
                                {{userInfo.remain}}
                             
                                <i class="el-icon-wallet" style="color:navy"></i>
                            </div>
                            <div class="myrow">
                                <h3>我的电话</h3>
                                <el-input
                                  v-model="phone"
                                  prefix-icon="el-icon-user-solid"
                                  style="width: 300px;"
                                  placeholder="尚未绑定电话"
                                  >
                                </el-input>
                            </div>
                            
                            <div class="myrow">
                                <h3>我的性别</h3>
                                <el-radio-group v-model="sex">
                                    <el-radio  :label="0">男</el-radio>
                                    <el-radio  :label="1">女</el-radio>
                                    <el-radio  :label="2">保密/未知</el-radio>
                                </el-radio-group>
                            </div>
                            
                            <div class="myrow">
                                <h3>我的微信号</h3>
                                <el-input
                                  v-model="wxNumber"
                                  prefix-icon="el-icon-user-solid"
                                  style="width: 300px;"
                                  placeholder="尚未绑定微信号"
                                  >
                                </el-input>
                            </div>
                        </div>
                        <div style="margin:18px 40px;">
                            <el-button type="primary" @click="submitchange(userInfo.uid,circleUrl,username,phone,sex,wxNumber)" style="margin-left: 30px;">提交修改</el-button>
                            <el-button style="margin-left: 50px;" @click="goBack">取消</el-button>
                        </div>
                        
                    </el-tab-pane>
                    <el-tab-pane label="修改密码">
                        <el-form label-position="top" label-width="80px" :model="formLabelAlign" style="margin:0 30px;">
                          <el-form-item label="请输入原密码">
                            <el-input v-model="formLabelAlign.code" style="width: 250px;"></el-input>
                          </el-form-item>
                          <el-form-item label="请输入新密码">
                            <el-input v-model="formLabelAlign.newcode" style="width: 250px;"></el-input>
                          </el-form-item>
                          <el-form-item label="请再次输入新密码进行确认">
                            <el-input v-model="formLabelAlign.newcodeagagin" style="width: 250px;"></el-input>
                          </el-form-item>
                          <el-form-item>
                            <el-button type="primary" @click="changecode">修改密码</el-button>
                            <el-button @click="newform" style="margin-left: 50px;">重置</el-button>
                          </el-form-item>
                        </el-form>
                    </el-tab-pane>
                    <el-tab-pane label="账号相关">
                        <div style="margin:0 30px;">
                            
                            <div class="myrow">
                                <h3>我的UID</h3>
                                {{userInfo.uid}}
                            </div>
                            
                            <div class="myrow">
                                <h3>我的账号</h3>
                                {{userInfo.account}}
                            </div>
                            
                            <div class="myrow">
                                <h3>绑定的手机号</h3>
                                {{userInfo.phone||'尚未绑定'}}
                            </div>
                            
                            <div class="myrow">
                                <h3>绑定的微信号</h3>
                                {{userInfo.wxNumber||'尚未绑定'}}
                            </div>
                            
                            <div class="myrow">
                                <h3>我的角色</h3>
                                {{userInfo.rolenum=='0'?'内测用户':(userInfo.rolenum=='1' ? '普通用户':(userInfo.rolenum=='2'?'健身博主':(userInfo.rolenum=='3'?'商家':'低信用用户')))}}
                            </div>
                            
                            <div class="myrow">
                                <h3>账号创建时间</h3>
                                {{userInfo.createTime}}
                            </div>

                            <div class="myrow">
                                <h3>账号更新时间</h3>
                                {{userInfo.updateTime}}
                            </div>
                            <el-button type="danger" style="margin: 20px;" @click="delmyaccount(userInfo.uid)">注销账号</el-button>
                        </div>
                    </el-tab-pane>
                    <el-tab-pane label="体重监管">
                        <el-card :body-style="{ padding: '20x' }" style="background-color: #bcbebf; margin-right: 750px">
                        <div style="margin:0 30px;">

                            <div class="myrow">
                                <h3>我的身高</h3>
                                {{userInfo.eid}}
                                cm
                                <el-button
                                        size="medium"
                                        @click="handleEdit(scope.$index, scope.row)" style="margin-left: 10px">编辑</el-button>

                            </div>

                            <div class="myrow">
                                <h3>最新体重</h3>
                                {{userInfo.account}}
                                kg
                                <el-button
                                        size="medium"
                                        @click="handleEdit(scope.$index, scope.row)" style="margin-left: 10px">编辑</el-button>

                            </div>

                            <div class="myrow">
                                <h3>最新BMI</h3>
                                {{userInfo.phone}}
                                 16
                                <el-progress :text-inside="true" :stroke-width="26" :stroke-length="20" :percentage="23" :color="customColorMethod" :format="ss"></el-progress>
                            </div>

                            <div class="myrow">
                                <h3>基础代谢</h3>
                                {{userInfo.wxNumber}}

                            </div>

                            <div class="myrow">
                                <h3>体重目标</h3>
                                {{userInfo.rolenum}}
                                kg
                                <el-button
                                        size="medium"
                                        @click="handleEdit(scope.$index, scope.row)" style="margin-left: 10px">编辑</el-button>
                                <h3 style="margin-left: 5px">达成时间</h3>
                                {{userInfo.rolenum}}
                                天
                                <el-button
                                        size="medium"
                                        @click="handleEdit(scope.$index, scope.row)" style="margin-left: 10px">编辑</el-button>
                            </div>

                            <div class="myrow">
                                <h3>热量预算</h3>
                                鉴于您需要在147天减去7kg,热量预算
                                {{userInfo.createTime}}
                                <el-tag type="success">1824千卡</el-tag>
                            </div>

                        </div>
                        </el-card>
                    </el-tab-pane>
                    <el-tab-pane label="我的栏目">
                        <div>
                            <el-col :span="11" v-for="(o, index) in 1" :key="o" :offset="index > 0 ? 1 : 0">
                                <el-card :body-style="{ padding: '20x' }" style="background-color: #c2e7b0">
                                    <div slot="header" class="clearfix">
                                        <span style="font-style: italic"><strong>我的栏目</strong></span>
                                    </div>
                                    <el-row style="padding: 14px;">

                                        <el-button type="primary" icon="el-icon-document-copy" circle size="200">我的订单</el-button>
                                        <el-button type="success" icon="el-icon-shopping-cart-full" circle> 购物小车 </el-button>
                                        <el-button type="info" icon="el-icon-basketball" circle>运动计划</el-button>
                                        <el-button type="danger" icon="el-icon-dish-1" circle>饮食记录</el-button>
                                    </el-row>
                                    <el-row style="padding: 14px;">
                                        <el-button type="primary" icon="el-icon-finished" circle plain>运动小结</el-button>
                                        <el-button type="success" icon="el-icon-edit-outline" circle plain>饮食测评</el-button>
                                        <el-button type="warning" icon="el-icon-chat-dot-square" circle plain>我的群组</el-button>
                                        <el-button type="warning" icon="el-icon-star-off" circle>我的收藏</el-button>

                                    </el-row>
                                    <div style="padding: 14px;">

                                        <div>
                                            <el-row :gutter="20">
                                                <el-col :span="2">
                                                    <div>
                                                        <el-statistic group-separator="," :precision="2" :value="value2" :title="title"></el-statistic>
                                                    </div>
                                                </el-col>
                                                <el-col :span="2">
                                                    <div>
                                                        <el-statistic  title="男女比">
                                                            <template slot="formatter">
                                                                456/2
                                                            </template>

                                                        </el-statistic>
                                                    </div>
                                                </el-col>
                                                <el-col :span="2">
                                                    <div>
                                                        <el-statistic group-separator="," :precision="2" decimal-separator="." :value="value1" :title="title">
                                                            <template slot="prefix">
                                                                <i class="el-icon-s-flag" style="color: red"></i>
                                                            </template>
                                                            <template slot="suffix">
                                                                <i class="el-icon-s-flag" style="color: blue"></i>
                                                            </template>
                                                        </el-statistic>
                                                    </div>

                                                </el-col>
                                                <el-col :span="2">
                                                    <div>
                                                        <el-statistic :value="like ? 521 : 520" title="Feedback">
                                                            <template slot="suffix">
                                                            <span @click="like = !like" class="like">
                                                              <i class="el-icon-star-on" style="color:red" v-show="!!like"></i>
                                                              <i class="el-icon-star-off"  v-show="!like"></i>
                                                            </span> </template>
                                                        </el-statistic>
                                                    </div>
                                                </el-col>
                                            </el-row>
                                        </div>

                                        <time class="time">{{ currentDate }}</time>
                                        <el-button type="text" class="button">操作按钮</el-button>
                                    </div>
                                </el-card>
                            </el-col>
                        </div>
                    </el-tab-pane>
                </el-tabs>
               </div>
            </div>
        </div>
        <div class="Snow" style="
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 99999;
    background: rgba(125,137,95,0.1);
    pointer-events: none;
">
            <canvas id="Snow"></canvas>
        </div>
        <script src="../../../public/plugins/vue/mystyle.js"></script>
        <!-- 开发环境版本，包含了有帮助的命令行警告 -->
        <script src="../../../public/plugins/vue/vue.js"></script>
        <!-- 引入组件库 -->
        <script src="../../../public/plugins/element-ui/index.js"></script>
        <script src="../../../public/plugins/axios/axios.min.js"></script>
        <script src="../../../public/js/request.js"></script>
        <script src="../../myapi/usercenter.js"></script>
        <script>
            new Vue({
                el: '#app',
                data() {
                    return {
                        like: true,
                        value1: 4154.564,
                        value2: 2222,
                        title: "今年的增长",
                        input: "Hello Element UI!",
                        currentDate: new Date(),
                        userInfo: {},
                        username:"",
                        phone:"",
                        sex:"",
                        wxNumber:"",
                        changeVisible:false,
                        circleUrl:'https://cube.elemecdn.com/e/fd/0fc7d20532fdaf769a25683617711png.png',
                        imageUrl: '',
                        formLabelAlign: {
                          username: '',
                          code: '',
                          newcode: ''
                        }
                    }
                },

                mounted() {
                  var userInfo = window.localStorage.getItem('userInfo')
                  userInfo = JSON.parse(userInfo)
                  this.userInfo=userInfo
                  this.username=userInfo.username
                  this.phone=userInfo.phone
                  this.sex=userInfo.sex
                  this.circleUrl=userInfo.avatar
                  this.wxNumber=userInfo.wxNumber
                  userInfo.createTime=userInfo.createTime.replace(/T/g, '  ').replace(/.[\d]{3}Z/, '  ')
                  userInfo.updateTime=userInfo.updateTime.replace(/T/g, '  ').replace(/.[\d]{3}Z/, '  ')
                },
                methods: {
                    customColorMethod(percentage) {
                        if (percentage < 18.5) {
                            return '#909399';
                        } else if (percentage < 23.9) {
                            return '#67c23a';
                        }else if (percentage < 27.9) {
                            return '#e6a23c';
                        }
                        else {
                            return '#ff0000';
                        }
                    },
                    ss(percentage) {
                        if (percentage < 18.5) {
                            return '偏瘦';
                        } else if (percentage < 23.9) {
                            return '理想';
                        }else if (percentage < 27.9) {
                            return '偏胖';
                        }
                        else {
                            return '很胖';
                        }
                    },
                    handleEdit(index, row) {
                        console.log(index, row);
                    },
                    handleDelete(index, row) {
                        console.log(index, row);
                    },
                    handleOpen(key, keyPath) {
                        console.log(key, keyPath);
                    },

                    handleClose(key, keyPath) {
                        console.log(key, keyPath);
                    },
                    handleAvatarSuccess(response, file,fileList) {
                        this.imageUrl = `/common/download?name=${response.data}`;
                        this.$forceUpdate() // 触发强制刷新
                    },
                    beforeAvatarUpload(file) {
                      const isJPEG = file.type === 'image/jpeg'
                      const isPNG = file.type === 'image/png'
                      const isJPG = file.type === 'image/jpg'
                      const isLt2M = file.size / 1024 / 1024 < 2;
                      if (!isJPG && !isPNG && !isJPEG) {
                        this.$message.error('上传图片只能是jpg，png，jpeg格式!');
                        return false
                      }
                      if (!isLt2M) {
                        this.$message.error('上传头像图片大小不能超过 2MB!');
                        return false
                      }
                      return true;
                    },
                    goBack() {
                        window.location.href='../../index.html'
                    },
                    changeavatar(){
                        this.circleUrl=this.imageUrl
                        this.changeVisible = false
                    },
                    submitchange(uid,avatar,username,phone,sex,wxNumber){
                        this.$confirm('确定提交修改吗？', '提示', {
                            'confirmButtonText': '确定',
                            'cancelButtonText': '取消',
                            'type': 'warning'
                        }).then(() => {
                            changeuserinfo(uid,avatar,username,phone,sex,wxNumber).then(res => {
                                if (String(res.code) === '1') {
                                    this.userInfo.avatar=avatar
                                    this.circleUrl=avatar
                                    this.userInfo.username=username
                                    this.username=username
                                    this.userInfo.phone=phone
                                    this.phone=phone
                                    this.userInfo.sex=sex
                                    this.sex=sex
                                    this.userInfo.wxNumber=wxNumber
                                    this.wxNumber=wxNumber
                                    localStorage.setItem('userInfo',JSON.stringify(this.userInfo))
                                    this.$message.success('已成功修改个人信息！')
                                }
                            }).catch(err => {
                                this.$message.error('请求出错了：' + err)
                            })
                        })
                    },
                    delmyaccount(uid){
                        this.$prompt('账号一旦注销后将永久无法恢复，请输入“YES”进行账号注销确认！', '提示', {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消'
                        }).then(({ value }) => {
                            if(value=='YES'){
                                deluser(uid).then(res => {
                                    if (String(res.code) === '1') {
                                        localStorage.removeItem('userInfo')
                                        this.$message({
                                            type: 'success',
                                            message: '已成功注销该账号！',
                                            duration: 2000,
                                            onClose:()=>{
                                                window.location.href='../../page/login/login.html'
                                            }
                                        });
                                    }
                                }).catch(err => {
                                    this.$message.error('请求出错了：' + err)
                                })
                            }else {
                                this.$message({
                                    type: 'error',
                                    message: '输入的不是“YES”，注销失败！'
                                });
                            }
                        }).catch(() => {
                        });
                    },
                }
            })
        </script>
    </body>
</html>
