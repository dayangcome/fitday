<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>视频详情</title>
        <link rel="stylesheet" href="../../../public/plugins/element-ui/index.css" />
        <style>
            .main{
                display: flex;
                flex-wrap: wrap;
                width: 100%;
                height: 100%;
                margin: 0 140px;
            }
            .myleft{
                display: flex;
                flex-direction: column;
                width:57%;
                margin-right: 30px;
            }
            .myright{
                display: flex;
                flex-direction: column;
                width: 40%;
            }
            .vdata{
                display: flex;
                flex-direction: column;
            }
            .thefont{
                display: inline-block;
                color: rgb(167,163,170);
                margin-right: 10px;
            }
            .smallicon{
                width: 20px;
            }
            .mv{
                width: 668px;
                height: 376px;
            }
            .interact{
                display: flex;
                margin-top: 18px;
            }
            i{
                font-size: 20px;
            }
            .onetab{
                margin-right: 5px;
            }
            .comment{
                display: flex;
                flex-direction: column;
            }
            .comminfo{
                display: flex;
                margin-bottom: 10px;
            }
            .mycomment{
                display: flex;
            }
            .myinput{
                width: 500px;
                margin: 0 20px ;
            }
            .image2 {
                width: 180px;
                height: 100%;
                border-radius: 10px;
            }
            .card-video .card {
                display: flex;
                width: 350px;
                height: 110px;
                margin: 10px 10px;
                border-radius: 10px;
                color: #000000;
                font-size: 20px;
                font-weight: 700;
                letter-spacing: 4px;
                cursor: pointer;
            }
            .image2:hover {
                transition: transform .2s, box-shadow .2s;
                transform: translateY(-4px);
                box-shadow: 4px 4px 8px rgba(0, 0, 0, .1), -4px -4px 8px rgba(0, 0, 0, .1);
            }
            .morevid{
                margin: 10px 30px;
            }
            .author{
                margin-top: 5px;
                font-size: 13px;
                color: #3e3e3e;
            }
            .card-video{
                display: flex;
                flex-direction: column;
            }
            .mycolo{
                display: flex;
                flex-direction: column;
                margin: 0 20px;
            }
            .theup{
                display: inline-block;
                margin: 5px 6px;
                font-size: 18px;
                font-weight: 700;
            }
            .myinfo:hover{
                color: rgb(107, 196, 240);
            }
            .author:hover{
                color: rgb(107, 196, 240);
            }
            .sendmss{
                display: inline-block;
            }
            .sendmss:hover{
                color: rgb(107, 196, 240);
                cursor: pointer;
            }
            .midicon{
                width: 30px;
            }
            .icon:hover{
                cursor: pointer;
            }
            .el-tag.el-tag--info:hover{
                cursor: pointer;
                background-color: #66b1ff;
                color: white;
            }
            .orig:hover{
                color: dodgerblue;
            }
            .intro{
                margin-bottom: 15px;
                color: #3e3e3e;
            }
            .el-message {
                top: 550px !important;
            }
            .time{
                float: right;
                margin-right: 60px;
                font-size: 12px;
                color: #818693;
            }
            .el-divider--horizontal{
                margin: 10px 0;
            }


        </style>
    </head>
    <body>
        <div id="app" style="display:flex;flex-wrap: wrap;">

            <div class="main">


                <div class="myleft">
                    <div v-if="go!='1'" style="margin: 10px 0;font-size: 17px;margin-left: -100px;">
                        <span @click="navto2" class="orig" style="font-weight: bold;cursor: pointer">首页</span>
                        <span>></span>
                        <span>视频详情</span>
                    </div>
                    <div v-if="go=='1'" style="margin: 10px 0;font-size: 17px;margin-left: -100px;">
                        <span @click="navto3" class="orig" style="font-weight: bold;cursor: pointer">社区</span>
                        <span>></span>
                        <span @click="navto4" class="orig" style="font-weight: bold;cursor: pointer">达人专区</span>
                        <span>></span>
                        <span>视频详情</span>
                    </div>
                    <div class="videoinfo">
                        <h2 style="margin: 20px 0 5px 0">{{myvideoinfo.title}}</h2>
                        <div class="vdata">
                            <div class="watchs">
                                <img src="../../../public/styles/icon/view.svg" class="smallicon" alt="">
                                <span class="thefont">{{myvideoinfo.hits}}</span>
                                <img src="../../../public/styles/icon/uptime.svg" class="smallicon" alt="">
                                <span class="thefont">{{myvideoinfo.uploadtime.toLocaleString().replace(/T/g, ' ').replace(/\.[\d]{3}Z/, '')}}</span>
                                <span class="thefont">未经作者授权，禁止转载</span>
                            </div>
                            <div class="myvideo">
                                <video class="mv" preload="metadata" crossorigin="anonymous" :src="myvideoinfo.videolink" controls="controls"> </video>
                            </div>
                            <div class="interact">
                                <svg width="36" height="36" viewBox="0 0 36 36" @click="tblue1" xmlns="http://www.w3.org/2000/svg" class="icon svg1"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.77234 30.8573V11.7471H7.54573C5.50932 11.7471 3.85742 13.3931 3.85742 15.425V27.1794C3.85742 29.2112 5.50932 30.8573 7.54573 30.8573H9.77234ZM11.9902 30.8573V11.7054C14.9897 10.627 16.6942 7.8853 17.1055 3.33591C17.2666 1.55463 18.9633 0.814421 20.5803 1.59505C22.1847 2.36964 23.243 4.32583 23.243 6.93947C23.243 8.50265 23.0478 10.1054 22.6582 11.7471H29.7324C31.7739 11.7471 33.4289 13.402 33.4289 15.4435C33.4289 15.7416 33.3928 16.0386 33.3215 16.328L30.9883 25.7957C30.2558 28.7683 27.5894 30.8573 24.528 30.8573H11.9911H11.9902Z"></path></svg>
                                <span class="thefont">{{myvideoinfo.likes}}</span>

                                <svg width="36" height="36" viewBox="0 0 28 28" @click="tblue2" xmlns="http://www.w3.org/2000/svg" class="icon svg2"><path fill-rule="evenodd" clip-rule="evenodd" d="M19.8071 9.26152C18.7438 9.09915 17.7624 8.36846 17.3534 7.39421L15.4723 3.4972C14.8998 2.1982 13.1004 2.1982 12.4461 3.4972L10.6468 7.39421C10.1561 8.36846 9.25639 9.09915 8.19315 9.26152L3.94016 9.91102C2.63155 10.0734 2.05904 11.6972 3.04049 12.6714L6.23023 15.9189C6.96632 16.6496 7.29348 17.705 7.1299 18.7605L6.39381 23.307C6.14844 24.6872 7.62063 25.6614 8.84745 25.0119L12.4461 23.0634C13.4276 22.4951 14.6544 22.4951 15.6359 23.0634L19.2345 25.0119C20.4614 25.6614 21.8518 24.6872 21.6882 23.307L20.8703 18.7605C20.7051 17.705 21.0339 16.6496 21.77 15.9189L24.9597 12.6714C25.9412 11.6972 25.3687 10.0734 24.06 9.91102L19.8071 9.26152Z"></path></svg>
                                <span class="thefont">{{myvideoinfo.saves}}</span>

                                <svg width="36" height="36" viewBox="0 0 28 28" @click="tblue3" xmlns="http://www.w3.org/2000/svg" class="icon svg3"><path d="M12.6058 10.3326V5.44359C12.6058 4.64632 13.2718 4 14.0934 4C14.4423 4 14.78 4.11895 15.0476 4.33606L25.3847 12.7221C26.112 13.3121 26.2087 14.3626 25.6007 15.0684C25.5352 15.1443 25.463 15.2144 25.3847 15.2779L15.0476 23.6639C14.4173 24.1753 13.4791 24.094 12.9521 23.4823C12.7283 23.2226 12.6058 22.8949 12.6058 22.5564V18.053C7.59502 18.053 5.37116 19.9116 2.57197 23.5251C2.47607 23.6489 2.00031 23.7769 2.00031 23.2122C2.00031 16.2165 3.90102 10.3326 12.6058 10.3326Z"></path></svg>
                                <span class="thefont">{{myvideoinfo.shares}}</span>
                            </div>
                            <el-divider></el-divider>
                            <div class="intro">
                                {{myvideoinfo.introduction}}
                            </div>
                            <div class="mytab">
                                <el-tag v-for="tag in tags" type="info" class="onetab">{{tag}}</el-tag>
                            </div>
                        </div>
                        <el-divider></el-divider>
                    </div>
                    <div class="comment">
                        <div class="comminfo">
                            <h4 style="margin: 0 5px">评论</h4>
                            <span class="thefont">{{comments.length}} </span>
                            <el-button type="text" style="padding: 0 5px;">最热</el-button>
                            <el-divider direction="vertical"></el-divider>
                            <el-button type="text" style="color: #9d9c9c;padding: 0 5px;">最新</el-button>
                        </div>
                        <div class="mycomment">
                            <el-avatar :size="50" src="https://s1.ax1x.com/2023/03/24/ppBJaQ0.png"></el-avatar>
                            <textarea
                                    :rows="2"
                                    maxlength="100"
                                    placeholder="请输入内容"
                                    v-model="mytextarea"
                                    class="myinput el-textarea__inner">
                            </textarea>
                            <el-button type="primary" @click="commets">发布</el-button>
                        </div>
                        <div style="margin: 10px 0;">

                                <div v-for="(item,i) in comments" style="margin: 10px 0;">
                                    <el-avatar :size="50" :src="item.avatar"></el-avatar>
                                    <strong style="vertical-align: 80%;margin-left: 5px">{{item.prepare}}</strong>
                                    <span class="time">{{i+1}}楼</span>
                                    <br><span style="color:rgb(14,16,16)">{{item.content}}</span><br>
                                    <span class="time">{{item.commentdate.toLocaleString().replace(/T/g, ' ').replace(/\.[\d]{3}Z/, '')}}</span>
                                    <br>
                                    <el-divider></el-divider>
                                </div>

                        </div>


                    </div>
                </div>
                <div class="myright">
                    <div style="display: flex">
                        <div style="margin: 15px 20px">
                            <el-avatar :size="50" :src="author.avatar"></el-avatar>
                        </div>
                        <div style="display: flex;flex-direction: column;margin: 10px 5px;">
                            <div>
                                <span class="theup">{{author.username}}</span>
                                <div class="sendmss">
                                    <i class="el-icon-message-solid"></i>
                                    <span class="smallicon">发信息</span>
                                </div>
                            </div>
                            <div style="margin:0 0 10px 10px;">
                                <span class="thefont">{{'该用户暂未设置个性签名'||author.sign}}</span>
                            </div>
                            <el-button v-if="false" type="info" style="width: 200px" round>+ 已关注 7772</el-button>
                            <el-button type="primary" style="width: 200px" round>+ 关注 7772</el-button>
                        </div>
                    </div>

                    <div class="morevid">
                        <h3 style="display: inline-block;margin-left: 10px">推荐视频</h3>
                        <div class="card-video">
                            <div v-for="item in videolist" @click="navto(item.uservideo.videoId)" class="card" >
                                <img :src="item.uservideo.picture" class="image2">
                                <div class="mycolo">
                                    <div class="myinfo">
                                        {{item.uservideo.title}}
                                    </div>
                                    <div class="author">
                                        UP {{item.authorname}}
                                    </div>
                                    <div class="author">

                                    </div>
                                </div>
                            </div>


                        </div>
                    </div>
                </div>
            </div>


        </div>
        <!-- 开发环境版本，包含了有帮助的命令行警告 -->
        <script src="../../../public/plugins/vue/vue.js"></script>
        <!-- 引入组件库 -->
        <script src="../../../public/plugins/element-ui/index.js"></script>
        <script src="../../../public/plugins/axios/axios.min.js"></script>
        <script src="../../../public/js/request.js"></script>
        <script src="../../myapi/video.js"></script>
        <script>
            new Vue({
                el: '#app',
                data() {
                    return {
                        activeName: 'first',
                        myvideoinfo:{},
                        userInfo:{},
                        tags:[],
                        mytextarea:'',
                        videolist:[],
                        author:{},
                        comments:[],
                        go:'0'
                    }
                },

                mounted() {
                    this.myvideoinfo=JSON.parse(window.localStorage.getItem("thevideo"))
                    window.localStorage.removeItem("thevideo")
                    this.author=JSON.parse(window.localStorage.getItem("author"))
                    window.localStorage.removeItem("author")
                    this.comments=JSON.parse(window.localStorage.getItem("comments"))
                    window.localStorage.removeItem("comments")
                    this.go=window.localStorage.getItem("go")
                    window.localStorage.removeItem("go")
                    this.tags=this.myvideoinfo.taps.split(" ")
                    this.init1()
                    this.userInfo = JSON.parse(localStorage.getItem('userInfo'))

                },
                methods: {
                    async init1(){
                        await getallvideo().then(res=>{
                            if(String(res.code) === '1'){
                                this.videolist=res.data
                                window.parent.postMessage(document.body.clientHeight-250,'*')
                            }
                        })

                    },
                    tblue1(){
                        if(document.querySelector(".svg1").style.fill==""){
                            document.querySelector(".svg1").style.fill="#00aeec"
                            thumb(1,this.userInfo.uid,this.myvideoinfo.videoId).then(res=>{
                                if(String(res.code) === '1'){
                                    this.myvideoinfo.likes=this.myvideoinfo.likes+1
                                }
                            })
                        }else{
                            document.querySelector(".svg1").style.fill=""
                        }
                    },
                    tblue2(){
                        if(document.querySelector(".svg2").style.fill==""){
                            document.querySelector(".svg2").style.fill="#00aeec"
                        }else{
                            document.querySelector(".svg2").style.fill=""
                        }
                        thumb(2,this.userInfo.uid,this.myvideoinfo.videoId).then(res=>{
                            if(String(res.code) === '1'){
                                this.myvideoinfo.saves=this.myvideoinfo.saves+1
                            }
                        })
                    },
                    tblue3(){
                        if(document.querySelector(".svg3").style.fill==""){
                            document.querySelector(".svg3").style.fill="#00aeec"
                        }else{
                            document.querySelector(".svg3").style.fill=""
                        }
                        thumb(3,this.userInfo.uid,this.myvideoinfo.videoId).then(res=>{
                            if(String(res.code) === '1'){
                                this.myvideoinfo.shares=this.myvideoinfo.shares+1
                            }
                        })
                    },
                    navto2(){
                        window.location.href="../home/home.html"
                    },
                    navto3(){
                        window.location.href="../community/community.html"
                    },
                    navto4(){
                        window.location.href="../community/case.html"
                    },
                    commets(){
                        addcomments(this.userInfo.uid,this.myvideoinfo.videoId,this.mytextarea).then(res=>{
                            if(String(res.code) === '1'){
                                this.$message.success("发布成功")
                                this.myinput=''
                                this.comments.push(res.data)
                            }else {
                                this.$message.error("发布失败")
                            }
                        })
                    },
                    async navto(videoId){
                        await getonevideo(videoId).then(res=>{
                            if(String(res.code) === '1'){
                                window.localStorage.setItem("thevideo",JSON.stringify(res.data))
                            }else{
                                console.log(res.msg)
                            }
                        })
                        await getauthor(videoId).then(res=>{
                            if(String(res.code) === '1'){
                                console.log(res.data)
                                window.localStorage.setItem("author",JSON.stringify(res.data))
                            }else{
                                console.log(res.msg)
                            }
                        })
                        await getcomments(videoId).then(res=>{
                            if(String(res.code) === '1'){
                                console.log(res.data)
                                window.localStorage.setItem("comments",JSON.stringify(res.data))
                            }else{
                                console.log(res.msg)
                            }
                        })
                        window.location.href = "../videodetails/videodetails.html"
                    },
                }
            })
        </script>
    </body>
</html>
